== カスタムビルドポリシー


Prisma Cloudには、設定ミスを検出し、統合コードリポジトリやパイプラインで見つかったセキュリティ問題を自動的に修正できるようにする、すぐに使えるポリシーが含まれています。*ガバナンス*から、*Build*のサブタイプフィルターを使用し、カスタムポリシーを含む構成ポリシーのリストを確認できます。

次の形式のカスタムビルドポリシーを作成できます。

* *Terraform*-Terraform 属性を使用して記述されたポリシーは、Terraform (.tf ファイルおよびプランファイル) に適用されます。
* *CloudFormation* - CloudFormation 属性を使用して作成されたポリシーは、CloudFormation、AWS サーバーレスアプリケーションモデル (SAM)、およびクラウド開発キット (CDK) に適用されます。
* *Kubernetes*- Kubernetes 属性を使用して作成されたポリシーは、Kubernetes、Helm、および Kustimizeに適用されます。

さらに、Prisma Cloud は、正規表現パターンを使用して定義できるカスタム シークレットの識別もサポートしています。
正規表現パターンを定義するときは、次のパラメーターを考慮してください。

* `正規表現` パターンが標準の正規表現フォーマット基準を満たしていることを確認する必要があります。
* `正規表現` パターンを定義する際に考慮すべき基準。
** パターンの長さは 5 ～ 100 文字で定義する必要があります。
** `backreferences`、`backtracking`、および `/.*/ や /.+/`のような無制限のワイルドカードがないことを確認してください。
* ポリシーごとに最大 5 つの `正規表現` パターンを定義できます。

[.task]

=== ビルド時チェック用の新しいカスタムポリシーを追加する


カスタム要件がある場合、または特定のセキュリティやコンプライアンスのニーズに合わせてガードレールを定義したい場合は、既存のリポジトリに新しいカスタムポリシーを柔軟に追加できます。xref:../../application-security/get-started/connect-code-and-build-providers/connect-code-and-build-providers.adoc[[コード プロバイダーとビルド プロバイダー]]を追加すると、すぐに、すぐに使用できるポリシーとカスタムポリシーの両方を使用して、潜在的な問題をスキャンします。

[.procedure]

. ビルド時チェックのカスタム設定ポリシーの作成

.. *[ガバナンス] > [ポリシーの追加] > [構成]*を選択します。
+
image::governance/custom-build.png[]

.. *ポリシー名を追加します*。
+
必要に応じて、*[説明]*を追加できます。ポリシーの説明には、エラーの概要、対策情報、ポリシーエラーが発生した場合の修正情報を含めることができます。

.. *Build（ビルド）*を選択します。
+
image::governance/custom-build-3.png[]
+
[*ビルド*] のみを選択するか、[*実行*] と [*ビルド*] の両方のサブタイプで続行するかを選択できます。ただし、以下のステップは、ビルドサブタイプ専用です。
+
カスタマイズされた実行ポリシーを作成するには、xref:../create-a-policy.adoc[「Prisma Cloudでのカスタムポリシーの作成」]を参照してください。

.. *ポリシーの [重要度] を選択します*。
+
Prisma Cloud は、5つのレベルのポリシー重大度 *(重大、高、中、低、情報)*をサポートします。
+
ポリシーの重要度は、ポリシー設定が環境に与える影響を定義するのに役立ち、*[アプリケーションセキュリティ] > [プロジェクト]* でスキャンした後に、設定ミスをフィルタリングするのに便利です。
+
オプションで、ポリシーに *ラベル* を追加できます。
+
この例では、関連するポリシーの詳細を含むログ配信が推奨されない S3 バケット ACL のカスタムビルドポリシーを表示されます。
+
image::governance/custom-build-7.png[]

.. *Next（次へ）*を選択します。


. カスタム設定ポリシーのルールを作成します。
+
カスタム設定ポリシールールでは、実行時とビルド時の両方、つまり実行ポリシーサブタイプとビルドポリシーサブタイプの設定を確認する基準を定義できます。次のステップでは、ビルドルールのみのポリシールールを作成します。
カスタムビルドポリシールールを作成するには、 [コードエディタ] と [ビジュアルエディター] のどちらかを選択できます。
+
* xref:code-editor.adoc[コードエディタ]
+
[コードエディタ]はビルド ポリシー ルールのデフォルト ビューであり、例として YAML ポリシー テンプレートがガイドラインとともにコンソール上で常に利用可能です。このエディタを選択して、YAML ポリシーテンプレートを使用してカスタムポリシールールを作成できます。
+
* xref:visual-editor.adoc[ビジュアルエディター]
+
このエディタを選択すると、接続状態なしでの属性チェックの作成と AND/OR ロジックに対応する簡単なカスタムポリシールールを作成できます。コンソールの既存のフィールドを使用します。これらのフィールドは、ほとんどがユーザーの選択に基づいて、自動的に入力されます。


. ビルドポリシーのコンプライアンス基準を追加します。

.. [*標準]、[要件*]、[*セクション*] を選択します。
+
* *標準は*、Prisma Cloud コンソールにリストされているデフォルトのコンプライアンス標準です。
* *要件は*、コンプライアンス基準の選択に影響されます。
* *[セクション] *は、コンプライアンス基準の影響を受ける場合と影響を受けない場合があります。
+
image::governance/custom-build-8.png[]

.. *Next（次へ）*を選択します。

. ビルドポリシーの修復。
+
現在、カスタムビルド ポリシーの修復推奨事項は利用できません。

. カスタムポリシーを送信します。
+
カスタムビルドポリシーを保存すると、次回のスキャンで、オンボードされたリソースが、新しいポリシーと照合されてスキャンされます。スキャン結果は [*アプリケーションセキュリティ] > [プロジェクト*] に表示され、チェックに失敗してポリシー違反を引き起こしたリソースを特定できます。
+
カスタム シークレットの場合、リポジトリあたり150を超える検出結果がある場合、ポリシーは自動的に無効になります。*[アプリケーションセキュリティ] > [プロジェクト]*でポリシーを編集できます。
